<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.fitfusion.mapper.FoodMapper">

    <!-- 1. 전체 조회 -->
    <select id="findAll" resultType="com.fitfusion.dto.FoodDto">
        SELECT *
        FROM FITFUSION_FOOD_ITEMS
    </select>

    <!-- 2. 음식명 키워드 검색 -->
    <select id="searchFoods" parameterType="String" resultType="com.fitfusion.dto.FoodDto">
        SELECT *
        FROM FITFUSION_FOOD_ITEMS
        WHERE FOOD_NAME LIKE '%' || #{keyword} || '%'
    </select>

    <!-- 3. 카테고리 코드로 검색 -->
    <select id="findByCategory" parameterType="String" resultType="com.fitfusion.dto.FoodDto">
        SELECT *
        FROM FITFUSION_FOOD_ITEMS
        WHERE FOOD_CATEGORY_CODE = #{categoryCode}
    </select>

    <!-- 4. 수입 여부 검색 -->
    <select id="findByImported" parameterType="String" resultType="com.fitfusion.dto.FoodDto">
        SELECT *
        FROM FITFUSION_FOOD_ITEMS
        WHERE IS_IMPORTED = #{isImported}
    </select>

    <!-- 5. 페이징 검색 -->
    <select id="searchFoodsByPaging"
            resultType="com.fitfusion.dto.FoodDto">
        SELECT *
        FROM FITFUSION_FOOD_ITEMS
        WHERE FOOD_NAME LIKE '%' || #{keyword} || '%'
        OFFSET #{offset} ROWS FETCH NEXT #{pageSize} ROWS ONLY
    </select>

    <!-- 6. 키워드별 count -->
    <select id="countFoodsByKeyword" parameterType="String" resultType="int">
        SELECT COUNT(*)
        FROM FITFUSION_FOOD_ITEMS
        WHERE FOOD_NAME LIKE '%' || #{keyword} || '%'
    </select>

    <!-- 7. insert -->
    <insert id="insertFood" parameterType="com.fitfusion.dto.FoodDto">
        <selectKey keyProperty="foodId" resultType="Integer" order="BEFORE">
            SELECT FITFUSION_FOOD_ITEMS_SEQ.NEXTVAL FROM DUAL
        </selectKey>

        INSERT INTO FITFUSION_FOOD_ITEMS (
        FOOD_ID,
        BARCODE,
        FOOD_NAME,
        GROUP_NAME,
        FOOD_CATEGORY_CODE,
        FOOD_CATEGORY_NAME,
        FOOD_MID_CATEGORY_CODE,
        FOOD_MID_CATEGORY_NAME,
        FOOD_SMALL_CATEGORY_CODE,
        FOOD_SMALL_CATEGORY_NAME,
        FOOD_DETAIL_CATEGORY_CODE,
        FOOD_DETAIL_CATEGORY_NAME,
        SERVING_SIZE,
        SERVING_UNIT_ID,
        FOOD_WEIGHT,
        REFERENCE_INTAKE,
        CALORIES,
        CARBOHYDRATE_G,
        PROTEIN_G,
        FAT_G,
        SUGAR_G,
        SODIUM_MG,
        CHOLESTEROL_MG,
        SATURATED_FAT_G,
        TRANS_FAT_G,
        POTASSIUM_MG,
        FIBER_G,
        IMAGE_URL,
        IS_USER_CREATED,
        CREATED_BY_USER_ID,
        CREATED_DATE,
        DATA_SOURCE_NAME,
        DATA_MODIFIED_DATE,
        DATA_TYPE,
        MAKER_NAME,
        IMPORTER_NAME,
        DISTRIBUTOR_NAME,
        ORIGIN_COUNTRY_NAME,
        IS_IMPORTED,
        IRON_MG,
        CALCIUM_MG,
        VITAMIN_C_MG,
        SUGAR_ALCOHOL_G,
        CAFFEINE_MG,
        ALCOHOL_G
        ) VALUES (
        #{foodId, jdbcType=INTEGER},
        #{barcode, jdbcType=VARCHAR},
        #{foodName, jdbcType=VARCHAR},
        #{groupName, jdbcType=VARCHAR},
        #{foodCategoryCode, jdbcType=VARCHAR},
        #{foodCategoryName, jdbcType=VARCHAR},
        #{foodMidCategoryCode, jdbcType=VARCHAR},
        #{foodMidCategoryName, jdbcType=VARCHAR},
        #{foodSmallCategoryCode, jdbcType=VARCHAR},
        #{foodSmallCategoryName, jdbcType=VARCHAR},
        #{foodDetailCategoryCode, jdbcType=VARCHAR},
        #{foodDetailCategoryName, jdbcType=VARCHAR},
        #{servingSize, jdbcType=NUMERIC},
        #{servingUnitId, jdbcType=INTEGER},
        #{foodWeight, jdbcType=NUMERIC},
        #{referenceIntake, jdbcType=NUMERIC},
        #{calories, jdbcType=NUMERIC},
        #{carbohydrateG, jdbcType=NUMERIC},
        #{proteinG, jdbcType=NUMERIC},
        #{fatG, jdbcType=NUMERIC},
        #{sugarG, jdbcType=NUMERIC},
        #{sodiumMg, jdbcType=NUMERIC},
        #{cholesterolMg, jdbcType=NUMERIC},
        #{saturatedFatG, jdbcType=NUMERIC},
        #{transFatG, jdbcType=NUMERIC},
        #{potassiumMg, jdbcType=NUMERIC},
        #{fiberG, jdbcType=NUMERIC},
        #{imageUrl, jdbcType=VARCHAR},
        #{isUserCreated, jdbcType=VARCHAR},
        #{createdByUserId, jdbcType=INTEGER},
        #{createdDate, jdbcType=TIMESTAMP},
        #{dataSourceName, jdbcType=VARCHAR},
        #{dataModifiedDate, jdbcType=TIMESTAMP},
        #{dataType, jdbcType=VARCHAR},
        #{makerName, jdbcType=VARCHAR},
        #{importerName, jdbcType=VARCHAR},
        #{distributorName, jdbcType=VARCHAR},
        #{originCountryName, jdbcType=VARCHAR},
        #{isImported, jdbcType=VARCHAR},
        #{ironMg, jdbcType=NUMERIC},
        #{calciumMg, jdbcType=NUMERIC},
        #{vitaminCMg, jdbcType=NUMERIC},
        #{sugarAlcoholG, jdbcType=NUMERIC},
        #{caffeineMg, jdbcType=NUMERIC},
        #{alcoholG, jdbcType=NUMERIC}
        )
    </insert>

    <!-- 8. update -->
    <update id="updateFood" parameterType="com.fitfusion.dto.FoodDto">
        UPDATE FITFUSION_FOOD_ITEMS
        SET
            BARCODE = #{barcode},
            FOOD_NAME = #{foodName},
            GROUP_NAME = #{groupName},
            FOOD_CATEGORY_CODE = #{foodCategoryCode},
            FOOD_CATEGORY_NAME = #{foodCategoryName},
            FOOD_MID_CATEGORY_CODE = #{foodMidCategoryCode},
            FOOD_MID_CATEGORY_NAME = #{foodMidCategoryName},
            FOOD_SMALL_CATEGORY_CODE = #{foodSmallCategoryCode},
            FOOD_SMALL_CATEGORY_NAME = #{foodSmallCategoryName},
            FOOD_DETAIL_CATEGORY_CODE = #{foodDetailCategoryCode},
            FOOD_DETAIL_CATEGORY_NAME = #{foodDetailCategoryName},
            SERVING_SIZE = #{servingSize},
            SERVING_UNIT_ID = #{servingUnitId},
            FOOD_WEIGHT = #{foodWeight},
            REFERENCE_INTAKE = #{referenceIntake},
            CALORIES = #{calories},
            CARBOHYDRATE_G = #{carbohydrateG},
            PROTEIN_G = #{proteinG},
            FAT_G = #{fatG},
            SUGAR_G = #{sugarG},
            SODIUM_MG = #{sodiumMg},
            CHOLESTEROL_MG = #{cholesterolMg},
            SATURATED_FAT_G = #{saturatedFatG},
            TRANS_FAT_G = #{transFatG},
            POTASSIUM_MG = #{potassiumMg},
            FIBER_G = #{fiberG},
            IMAGE_URL = #{imageUrl},
            IS_USER_CREATED = #{isUserCreated},
            CREATED_BY_USER_ID = #{createdByUserId},
            CREATED_DATE = #{createdDate},
            DATA_SOURCE_NAME = #{dataSourceName},
            DATA_MODIFIED_DATE = #{dataModifiedDate},
            DATA_TYPE = #{dataType},
            MAKER_NAME = #{makerName},
            IMPORTER_NAME = #{importerName},
            DISTRIBUTOR_NAME = #{distributorName},
            ORIGIN_COUNTRY_NAME = #{originCountryName},
            IS_IMPORTED = #{isImported},
            IRON_MG = #{ironMg},
            CALCIUM_MG = #{calciumMg},
            VITAMIN_C_MG = #{vitaminCMg},
            SUGAR_ALCOHOL_G = #{sugarAlcoholG},
            CAFFEINE_MG = #{caffeineMg},
            ALCOHOL_G = #{alcoholG}
        WHERE FOOD_ID = #{foodId}
    </update>

    <!-- 9. delete -->
    <delete id="deleteFood" parameterType="String">
        DELETE FROM FITFUSION_FOOD_ITEMS
        WHERE FOOD_ID = #{foodId}
    </delete>

    <!-- 10. 모든 FOOD_NAME 목록 조회 -->
    <select id="findAllFoodNames" resultType="String">
        SELECT FOOD_NAME
        FROM FITFUSION_FOOD_ITEMS
    </select>



</mapper>
