<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìŒì‹ ì´ë¯¸ì§€ ì—…ë¡œë“œ</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 30px; }
        h2, h3 { color: #333; }
        #result-area { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
        ul { list-style: none; padding: 0; }
        li { padding: 5px 0; }
    </style>
</head>
<body>

<h2>ìŒì‹ ì´ë¯¸ì§€ ì—…ë¡œë“œ</h2>

<form id="upload-form" enctype="multipart/form-data">
    <input type="file" name="image" accept="image/*" required>
    <button type="submit">ë¶„ì„í•˜ê¸°</button>
</form>

<div id="result-area"></div>

<script>
    $('#upload-form').on('submit', function (e) {
        e.preventDefault();  // ê¸°ë³¸ ì œì¶œ ë§‰ê¸°

        const formData = new FormData(this);
        $('#result-area').html('<p>ğŸ¥£ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>');

        $.ajax({
            url: 'http://localhost:8000/detect/',  // FastAPI ì„œë²„ ì£¼ì†Œ
            method: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (data) {
                let resultHtml = '<h3>ë¶„ì„ ê²°ê³¼</h3>';
                resultHtml += '<ul>';
                for (let food in data.detected_counts) {
                    const count = data.detected_counts[food];
                    const cal = data.estimated_calories[food];
                    resultHtml += `<li><strong>${food}</strong> : ${count}ê°œ (${cal} kcal)</li>`;
                }
                resultHtml += '</ul>';
                resultHtml += `<p><strong>ì´ ì¹¼ë¡œë¦¬:</strong> ${data.total_calories} kcal</p>`;
                $('#result-area').html(resultHtml);
            },
            error: function (xhr) {
                $('#result-area').html(`<p style="color:red;">ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${xhr.responseText}</p>`);
            }
        });
    });
</script>

</body>
</html>
