  <!DOCTYPE html>
  <html xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns:sec="http://www.w3.org/1999/xhtml"
        layout:decorate="~{layout/base}">

  <head>
    <title>Ìó¨Ïä§Ïû• ÏÉÅÏÑ∏Ï†ïÎ≥¥</title>
    <link rel="stylesheet" th:href="@{/css/gym-detail.css}">
  </head>

  <body>
  <main layout:fragment="content" class="container py-5">

    <div class="wrapper">

      <!-- ÏÉÅÎã® Ïù¥ÎØ∏ÏßÄ + Ï∞ú Î≤ÑÌäº -->
      <div class="gym-header">
        <img src="/images/healthGym.jpg" alt="Ìó¨Ïä§Ïû• Ïù¥ÎØ∏ÏßÄ">
        <div sec:authorize="isAuthenticated()">
          <button id="like-btns" class="like-button"
                  th:classappend="${isLiked} ? 'liked' : ''">
            <span th:text="${isLiked} ? '‚ù§Ô∏è Ï∞úÎê®' : 'ü§ç Ï∞úÌïòÍ∏∞'"></span>
          </button>
        </div>
      </div>

      <!-- ÏßÄÎèÑ ÌéòÏù¥ÏßÄÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞ Î≤ÑÌäº -->
      <div class="back-button-container">
        <a th:href="@{/map}" class="back-button">‚Üê ÏßÄÎèÑ ÌéòÏù¥ÏßÄÎ°ú</a>
      </div>

      <!-- ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î∞ïÏä§ -->
      <div class="gym-container">
        <h2 th:text="${detailData.getName()}">Ìó¨Ïä§Ïû•Ïù¥Î¶Ñ</h2>
        <p><strong>Ï£ºÏÜå:</strong><span th:text="${detailData.getAddress()}"></span></p>
        <p><strong>Ï†ÑÌôîÎ≤àÌò∏:</strong><span th:text="${detailData.getPhone()}"></span></p>
        <hr>

        <!--  ÌèâÍ∑† ÌèâÏ†ê Î∞ïÏä§ -->
        <h3 class="section-title">‚≠ê Ïù¥Ïö© ÌõÑÍ∏∞</h3>
        <div class="rating-box">
          <ul class="average-rating">
            <strong th:text="${detailData.getAverageRating()}"></strong><span th:text=" 'Î≥ÑÏ†ê' + ${detailData.getReviewCount()} + 'Í∞ú'" class="review-count"></span>
            <div class="star-icons">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
          </ul>
        </div>

        <!-- Î¶¨Î∑∞ ÏûëÏÑ± Î≤ÑÌäº -->
        <div sec:authorize="isAuthenticated()" class="write-review-box my-3">
          <button class="btn btn-primary" id="review-btn">Î¶¨Î∑∞ ÏûëÏÑ±ÌïòÍ∏∞</button>
        </div>

        <!-- Î¶¨Î∑∞ ÏûëÏÑ± Ìèº -->
        <div id="review-form" style="display: none;" class="card p-4 shadow-sm mb-4">
          <input type="hidden" id="gymId" th:value="${detailData.gymId}" />

          <div class="mb-3">
            <label for="rating" class="form-label">Î≥ÑÏ†ê</label>
            <select id="rating" class="form-select">
              <option value="1">‚≠ê</option>
              <option value="2">‚≠ê‚≠ê</option>
              <option value="3">‚≠ê‚≠ê‚≠ê</option>
              <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
              <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="content" class="form-label">Î¶¨Î∑∞ ÎÇ¥Ïö©</label>
            <textarea id="content" class="form-control" rows="3" placeholder="ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
          </div>

          <div class="text-end">
            <button id="review-submit-btn" class="btn btn-success">Î¶¨Î∑∞ Ï†úÏ∂ú</button>
          </div>
        </div>

        <!--  Î¶¨Î∑∞ Ïπ¥Îìú Î™©Î°ù -->
        <ul>
          <li th:each="review : ${detailData.gymReviews}">
            <div class="review-card" id="${review.reviewId}">
              <div class="review-header">
                <div>
                  <p class="username"
                     th:if="${user != null}"
                     th:text="${review.getUser().name}">ÏïÑÏù¥Îîî</p>
                  <p class="stars" th:if="${review.rating != null}">
                    <span th:each="i : ${#numbers.sequence(1, review.rating)}">‚≠ê</span>
                  </p>
                </div>
                <span class="review-date"
                      th:text="${#dates.format(review.createdDate, 'yyyy-MM-dd')}">ÎÇ†Ïßú</span>
                <div th:if="${loginUserId != null and loginUserId == review.user.userId}">
                  <button class="edit-button" th:attr="data-comment-id=${review.reviewId}">ÏàòÏ†ï</button>
                  <button class="delete-button" th:attr="data-comment-id=${review.reviewId}">ÏÇ≠Ï†ú</button>
                </div>
              </div>
              <div class="review-content">
                <p th:text="${review.content}">ÎÇ¥Ïö©</p>
              </div>

              <!-- ÏàòÏ†ï Ìèº (Í∏∞Î≥∏ Ïà®ÍπÄ) -->
              <div class="edit-form" style="display: none;">
                <div class="mb-2">
                  <label>Î≥ÑÏ†ê</label>
                  <select class="form-select rating-select">
                    <option value="1" th:selected="${review.rating == 1}">‚≠ê</option>
                    <option value="2" th:selected="${review.rating == 2}">‚≠ê‚≠ê</option>
                    <option value="3" th:selected="${review.rating == 3}">‚≠ê‚≠ê‚≠ê</option>
                    <option value="4" th:selected="${review.rating == 4}">‚≠ê‚≠ê‚≠ê‚≠ê</option>
                    <option value="5" th:selected="${review.rating == 5}">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                  </select>
                </div>

                <div class="mb-2">
                  <label>Î¶¨Î∑∞ ÎÇ¥Ïö©</label>
                  <textarea class="form-control content-textarea" rows="3"
                            th:text="${review.content}"></textarea>
                </div>

                <button class="edit-submit-button btn btn-sm btn-success mt-2">ÏàòÏ†ï ÏôÑÎ£å</button>
              </div>

            </div>
          </li>
        </ul>
        <hr>

        <input type="hidden" id="latitude" th:value="${detailData.getLatitude()}" />
        <input type="hidden" id="longitude" th:value="${detailData.getLongitude()}" />

        <!-- ÏßÄÎèÑ ÏòÅÏó≠ -->
        <h3>üìç ÏúÑÏπò</h3>
        <div id="map"></div>
      </div>

    </div>

  </main>

  <!--  Ï∂îÍ∞ÄÎêú Ïä§ÌÅ¨Î¶ΩÌä∏ ÏòÅÏó≠Îßå ÏïÑÎûòÏóê Ïú†ÏßÄ -->
  <div layout:fragment="script">
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=96263ed7ed52fb388f0ed47a45e746cd&libraries=services"></script>
    <script th:src="@{/js/gym-detail.js}"></script>
  </div>

  </body>
  </html>
