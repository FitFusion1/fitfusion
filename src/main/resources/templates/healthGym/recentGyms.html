<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">

<head>
    <title>í—¬ìŠ¤ì¥ ë¹„êµ</title>
    <link rel="stylesheet" th:href="@{/css/compareGyms.css}">
</head>

<body>
<main layout:fragment="content" class="container py-5 d-flex flex-column min-vh-100">
    <h2 class="mb-4 text-center fw-bold">ìµœê·¼ ì°¾ì•„ë³¸ í—¬ìŠ¤ì¥</h2>

    <form id="compareForm" class="flex-grow-1">
        <table class="table table-bordered text-center align-middle">
            <thead class="table-dark">
            <tr>
                <th></th>
                <th>ì´ë¦„</th>
                <th>ì£¼ì†Œ</th>
                <th>â­ í‰ê·  ë³„ì </th>
                <th>â¤ï¸ ì°œ ìˆ˜</th>
                <th>ğŸ’¬ ë¦¬ë·° ìˆ˜</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="gym : ${detailDataList}">
                <td>
                    <label>
                        <input type="checkbox" name="gym"
                               th:value="${gym.gymId}"
                               th:data-name="${gym.name}"
                               th:data-rating="${gym.averageRating}"
                               th:data-review="${gym.reviewCount}" >
                    </label>
                </td>
                <td th:text="${gym.name}"></td>
                <td th:text="${gym.address}"></td>
                <td th:text="${gym.averageRating}"></td>
                <td th:text="${like[gym.gymId]}"></td>
                <td th:text="${gym.reviewCount}"></td>
            </tr>
            </tbody>
        </table>



        <div class="text-center mt-4">
            <button type="button" class="btn btn-success px-4 me-3" onclick="compareGyms()">ë¹„êµí•˜ê¸°</button>
            <a th:href="@{/map}" class="btn btn-secondary px-4">ì´ì „ìœ¼ë¡œ</a>
        </div>
    </form>
</main>

<th:block layout:fragment="script">
    <script>
            function compareGyms() {
                const checked  = document.querySelectorAll('input[name="gym"]:checked');
                if (checked .length < 2 || checked .length > 3) {
                    alert("í—¬ìŠ¤ì¥ì„ ìµœì†Œ 2ê°œ ì´ìƒ, 3ê°œ ì´í•˜ë¡œ ì„ íƒí•´ì£¼ì„¸ìš”");
            }   else {
                    const gyms = [];
                    checked.forEach((checkbox) => {
                        gyms.push({
                            id: checkbox.value,
                            name: checkbox.dataset.name,
                            rating: parseFloat(checkbox.dataset.rating),
                            review: parseInt(checkbox.dataset.review)
                        });
                    });
                        gyms.sort((a, b) => b.rating - a.rating);

                        let result = "í—¬ìŠ¤ì¥ ë¹„êµ ê²°ê³¼ (ë³„ì  ê¸°ì¤€)\n";
                        gyms.forEach((gym, i) => {
                            result += `${i + 1}ìœ„, ${gym.name} - ${gym.rating}ì , ${gym.review}ê°œ ë¦¬ë·°\n`;
                        });
                        alert(result);
                }
        }
    </script>
</th:block>
</body>
</html>
