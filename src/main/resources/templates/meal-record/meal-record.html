<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/base}">
<head>
    <title>ÏãùÎã® Í∏∞Î°ù</title>
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/meal-record.css}">
    </th:block>
</head>

<body class="meal-record__body">
<div layout:fragment="content" class="meal-record__container">

    <!-- ÎÇ†Ïßú ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
    <div th:replace="~{meal/date-nav :: date-nav(
                                                    date=${date},
                                                    prevDate=${prevDate},
                                                    nextDate=${nextDate},
                                                    titleText='Ïò§ÎäòÏùò ÏãùÎã®ÏùÑ ÌèâÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!',
                                                    prevPath='/meal/record',
                                                    currentPath='/meal/evaluation',
                                                    nextPath='/meal/record')}">
    </div>

    <!-- ÌéòÏù¥ÏßÄ Ï†úÎ™© -->
    <h1 class="meal-record__page-title">üçΩÔ∏è ÏãùÎã® Í∏∞Î°ù</h1>

<!-- ÎÅºÎãàÎ≥Ñ ÏÑπÏÖò -->
<th:block th:each="mealTime : ${mealTimes}">
    <div class="meal-record__card">
        <div class="meal-record__card-header">
            <h5 class="meal-record__card-title" th:text="${mealTime.displayName}">ÏïÑÏπ®</h5>
            <button type="button" class="meal-record__btn-add-meal"
                    data-bs-toggle="modal"
                    th:attr="data-bs-target='#modal-food-search',
                             data-meal=${mealTime.name()},
                             data-meal-display=${mealTime.displayName}">
                ÏùåÏãù Ï∂îÍ∞Ä
            </button>
        </div>
        <div class="meal-record__card-body">
            <ul class="meal-record__list-group" th:id="${'list-' + mealTime}">
                <!-- mealRecordsÍ∞Ä ÎπÑÏñ¥ÏûàÏßÄ ÏïäÏùÑ Í≤ΩÏö∞ <li>Îßå Î∞òÎ≥µ -->
                <th:block th:if="${not #lists.isEmpty(mealRecords.get(mealTime))}">
                    <li th:each="record : ${mealRecords.get(mealTime)}" class="meal-record__list-group-item">
                        <div>
                            <div class="meal-record__food-name" th:text="${record.foodName}">ÏùåÏãùÎ™Ö</div>
                            <div class="meal-record__user-intake"
                                 th:text="${record.formattedUserIntake + ' ' + record.foodServingSizeUnit.symbol}"></div>
                        </div>

                        <!-- ÏòÅÏñëÏÜå ÏÉÅÏÑ∏Î≥¥Í∏∞ Î≤ÑÌäº -->
                        <button type="button" class="btn btn-link"
                                data-bs-toggle="modal"
                                th:attr="data-bs-target=${'#modal-nutrient-' + record.mealRecordId}">
                            ÏòÅÏñëÏÜå ÏÉÅÏÑ∏Î≥¥Í∏∞
                        </button>

                        <form th:action="@{'/meal/delete/' + ${record.mealRecordId}}" method="post">
                            <button type="submit" class="meal-record__btn-delete-meal">ÏÇ≠Ï†ú</button>
                        </form>
                    </li>
                </th:block>
                <!-- mealRecordsÍ∞Ä ÎπÑÏñ¥ÏûàÏùÑ Í≤ΩÏö∞ Î©îÏãúÏßÄ <li> -->
                <li th:if="${#lists.isEmpty(mealRecords.get(mealTime))}" class="meal-record__list-group-item text-center">
                    Í∏∞Î°ùÎêú ÏùåÏãùÏù¥ ÏóÜÏäµÎãàÎã§.
                </li>
            </ul>
        </div>
    </div>
    <!-- ÏòÅÏñëÏÜå ÏÉÅÏÑ∏Î≥¥Í∏∞(Î™®Îã¨) -->
    <th:block th:if="${not #lists.isEmpty(mealRecords.get(mealTime))}">
        <th:block th:each="record : ${mealRecords.get(mealTime)}">
            <div class="modal fade" th:id="${'modal-nutrient-' + record.mealRecordId}" tabindex="-1" aria-hidden="true" aria-labelledby="modalLabel" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" th:text="${record.foodName} + ' ÏòÅÏñëÏÜå Ï†ïÎ≥¥'">ÏòÅÏñëÏÜå Ï†ïÎ≥¥</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form th:action="@{'/meal/update/' + ${record.mealRecordId}}" method="post">
                            <input type="hidden" name="mealRecordId" th:value="${record.mealRecordId}" />
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label th:for="${'user-intake-input-' + record.mealRecordId}" class="form-label">ÏÑ≠Ï∑®Îüâ (g)</label>
                                    <input type="number"
                                           th:id="${'user-intake-input-' + record.mealRecordId}"
                                           class="form-control"
                                           name="userIntake"
                                           min="1"
                                           th:value="${record.formattedServingSize}"
                                           required>
                                </div>
                                <div>
                                    <p>
                                        Ïó¥Îüâ:
                                        <span data-nutrient="calories" th:text="${record.calories}" th:if="${record.calories != null}"></span>
                                        <span th:if="${record.calories != null}">kcal</span>
                                    </p>
                                    <p>
                                        ÌÉÑÏàòÌôîÎ¨º:
                                        <span data-nutrient="carbohydrateG" th:text="${record.carbohydrateG}" th:if="${record.carbohydrateG != null}"></span>
                                        <span th:if="${record.carbohydrateG != null}">g</span>
                                    </p>
                                    <p>
                                        ÎãπÎ•ò:
                                        <span data-nutrient="sugarG" th:text="${record.sugarG}" th:if="${record.sugarG != null}"></span>
                                        <span th:if="${record.sugarG != null}">g</span>
                                    </p>
                                    <p>
                                        ÎãπÏïåÏΩú:
                                        <span data-nutrient="sugarAlcoholG" th:text="${record.sugarAlcoholG}" th:if="${record.sugarAlcoholG != null}"></span>
                                        <span th:if="${record.sugarAlcoholG != null}">g</span>
                                    </p>
                                    <p>
                                        ÏãùÏù¥ÏÑ¨Ïú†:
                                        <span data-nutrient="fiberG" th:text="${record.fiberG}" th:if="${record.fiberG != null}"></span>
                                        <span th:if="${record.fiberG != null}">g</span>
                                    </p>
                                    <p>
                                        Îã®Î∞±Ïßà:
                                        <span data-nutrient="proteinG" th:text="${record.proteinG}" th:if="${record.proteinG != null}"></span>
                                        <span th:if="${record.proteinG != null}">g</span>
                                    </p>
                                    <p>
                                        ÏßÄÎ∞©:
                                        <span data-nutrient="fatG" th:text="${record.fatG}" th:if="${record.fatG != null}"></span>
                                        <span th:if="${record.fatG != null}">g</span>
                                    </p>
                                    <p>
                                        Ìè¨ÌôîÏßÄÎ∞©:
                                        <span data-nutrient="saturatedFatG" th:text="${record.saturatedFatG}" th:if="${record.saturatedFatG != null}"></span>
                                        <span th:if="${record.saturatedFatG != null}">g</span>
                                    </p>
                                    <p>
                                        Ìä∏ÎûúÏä§ÏßÄÎ∞©:
                                        <span data-nutrient="transFatG" th:text="${record.transFatG}" th:if="${record.transFatG != null}"></span>
                                        <span th:if="${record.transFatG != null}">g</span>
                                    </p>
                                    <p>
                                        ÏΩúÎ†àÏä§ÌÖåÎ°§:
                                        <span data-nutrient="cholesterolMg" th:text="${record.cholesterolMg}" th:if="${record.cholesterolMg != null}"></span>
                                        <span th:if="${record.cholesterolMg != null}">mg</span>
                                    </p>
                                    <p>
                                        Î∂àÌè¨ÌôîÏßÄÎ∞©ÏÇ∞:
                                        <span data-nutrient="unsaturatedFatG" th:text="${record.unsaturatedFatG}" th:if="${record.unsaturatedFatG != null}"></span>
                                        <span th:if="${record.unsaturatedFatG != null}">g</span>
                                    </p>
                                    <p>
                                        ÎÇòÌä∏Î•®:
                                        <span data-nutrient="sodiumMg" th:text="${record.sodiumMg}" th:if="${record.sodiumMg != null}"></span>
                                        <span th:if="${record.sodiumMg != null}">mg</span>
                                    </p>
                                    <p>
                                        Ïπ¥ÌéòÏù∏:
                                        <span data-nutrient="caffeineMg" th:text="${record.caffeineMg}" th:if="${record.caffeineMg != null}"></span>
                                        <span th:if="${record.caffeineMg != null}">mg</span>
                                    </p>
                                    <p>
                                        ÏπºÏäò:
                                        <span data-nutrient="calciumMg" th:text="${record.calciumMg}" th:if="${record.calciumMg != null}"></span>
                                        <span th:if="${record.calciumMg != null}">mg</span>
                                    </p>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">ÏûÖÎ†•</button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ï∑®ÏÜå</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </th:block>
    </th:block>
</th:block>
<div th:replace="~{meal-record/modal-food-search :: modal-food-search}"></div>

</div>

<th:block layout:fragment="script">
    <script th:src="@{/js/meal-record.js}"></script>
</th:block>
</body>
</html>