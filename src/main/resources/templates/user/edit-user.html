<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/base}">
<head>
    <title>내 정보 수정</title>
    <link layout:fragment="css" rel="stylesheet" th:href="@{/css/edit-user.css}">
</head>
<body>
<section layout:fragment="content" class="main edit-user-main">
    <div class="container">
        <div class="edit-user-container">
            <!-- Page Header -->
            <div class="page-header">
                <h1>
                    <i class="bi bi-person-gear"></i>
                    내 정보 수정
                </h1>
                <p>프로필 정보를 수정하고 관리하세요</p>
            </div>

            <!-- Edit User Form -->
            <div class="form-section">
                <form th:action="@{/user/edit}" method="post" th:object="${userEditForm}" class="edit-user-form">
                    <!-- Read-only fields -->
                    <input type="hidden" th:field="*{userId}"/>
                    <div class="form-group">
                        <label for="username">아이디</label>
                        <input type="text" th:field="*{username}" th:value="*{username}" readonly>
                        <span class="field-note">아이디는 변경할 수 없습니다</span>
                    </div>

                    <div class="form-group">
                        <label for="name">이름</label>
                        <input type="text" th:field="*{name}" th:value="*{name}" readonly>
                        <span class="field-note">이름은 변경할 수 없습니다</span>
                    </div>

                    <div class="form-group">
                        <label for="gender">성별</label>
                        <select th:field="*{gender}" th:value="*{gender}" disabled>
                            <option value="M" th:selected="*{gender == 'M'}">남성</option>
                            <option value="F" th:selected="*{gender == 'F'}">여성</option>
                        </select>
                        <span class="field-note">성별은 변경할 수 없습니다</span>
                    </div>

                    <!-- Editable fields -->
                    <div class="form-group">
                        <label for="email">이메일</label>
                        <input type="email" th:field="*{email}" placeholder="you@email.com">
                        <span class="message-container">
                            <span class="error-message" data-error-cat="empty">이메일을 입력해주세요.</span>
                            <span class="error-message" data-error-cat="format">올바른 이메일 형식을 입력해주세요.</span>
                            <span class="error-message" data-error-cat="duplicate">중복된 이메일입니다.</span>
                            <span class="error-message" data-error-cat="same">현재 이메일과 동일합니다.</span>
                            <span class="error-message invalid" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></span>
                            <span class="valid-message" data-valid-cat="email">사용가능한 이메일입니다.</span>
                        </span>
                    </div>

                    <div class="form-group">
                        <label>비밀번호</label>
                        <div class="password-change-area">
                            <p class="password-info">비밀번호를 변경하려면 아래 버튼을 클릭하세요</p>
                            <button type="button" class="password-change-btn-inline" onclick="openPasswordModal()">
                                <i class="bi bi-key"></i>
                                비밀번호 변경
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="height">신장 (cm)</label>
                        <input type="text" th:field="*{height}" th:value="*{height}" inputmode="numeric" pattern="[0-9]*">
                        <span class="message-container">
                            <span class="error-message" data-error-cat="empty">신장을 입력해주세요.</span>
                            <span class="error-message" data-error-cat="format">올바른 값을 입력해주세요 (80-222cm).</span>
                            <span class="error-message invalid" th:if="${#fields.hasErrors('height')}" th:errors="*{height}"></span>
                        </span>
                    </div>

                    <div class="form-group">
                        <label for="weight">체중 (kg)</label>
                        <input type="text" th:field="*{weight}" th:value="*{weight}" inputmode="numeric" pattern="[0-9]*">
                        <span class="message-container">
                            <span class="error-message" data-error-cat="empty">체중을 입력해주세요.</span>
                            <span class="error-message" data-error-cat="format">올바른 값을 입력해주세요 (20-500kg).</span>
                            <span class="error-message invalid" th:if="${#fields.hasErrors('weight')}" th:errors="*{weight}"></span>
                        </span>
                    </div>

                    <div class="form-group">
                        <label for="birthDate">생년월일</label>
                        <input type="date" th:field="*{birthDate}" th:value="${#dates.format(userEditForm.birthDate, 'yyyy-MM-dd')}" th:min="1900-01-01" th:max="${#dates.format(currentDate, 'yyyy-MM-dd')}">
                        <span class="message-container">
                            <span class="error-message" data-error-cat="empty">생년월일을 입력해주세요.</span>
                            <span class="error-message invalid" th:if="${#fields.hasErrors('birthDate')}" th:errors="*{birthDate}"></span>
                        </span>
                    </div>

                    <div class="form-group">
                        <label for="experienceLevel">숙련도</label>
                        <select th:field="*{experienceLevel}">
                            <option value="">선택</option>
                            <option value="beginner" th:selected="*{experienceLevel == 'beginner'}">초급</option>
                            <option value="intermediate" th:selected="*{experienceLevel == 'intermediate'}">중급</option>
                            <option value="advanced" th:selected="*{experienceLevel == 'advanced'}">고급</option>
                        </select>
                        <span class="message-container">
                            <span class="error-message" data-error-cat="empty">숙련도를 선택해주세요.</span>
                            <span class="error-message invalid" th:if="${#fields.hasErrors('experienceLevel')}" th:errors="*{experienceLevel}"></span>
                        </span>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="submit" class="save-btn">
                            <i class="bi bi-check-circle"></i>
                            변경사항 저장
                        </button>
                        <a th:href="@{/mypage}" class="cancel-btn">
                            <i class="bi bi-x-circle"></i>
                            취소
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div id="passwordModal" class="password-modal">
        <div class="password-modal-content">
            <div class="password-modal-header">
                <h3>
                    <i class="bi bi-key"></i>
                    비밀번호 변경
                </h3>
                <button type="button" class="close-btn" onclick="closePasswordModal()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>

            <form th:object="${passwordForm}" id="passwordChangeForm" class="password-change-form">
                <div class="form-group">
                    <label for="currentPassword">현재 비밀번호</label>
                    <input type="password" th:field="*{currentPassword}" placeholder="현재 비밀번호를 입력하세요">
                    <span class="message-container">
                    <span class="error-message" data-error-cat="empty">현재 비밀번호를 입력해주세요.</span>
                    <span class="error-message" data-error-cat="mismatch">현재 비밀번호가 일치하지 않습니다.</span>
                </span>
                </div>

                <div class="form-group">
                    <label for="newPassword">새 비밀번호</label>
                    <input type="password" th:field="*{newPassword}" placeholder="새 비밀번호 (6글자 이상)">
                    <span class="message-container">
                    <span class="error-message" data-error-cat="empty">새 비밀번호를 입력해주세요.</span>
                    <span class="error-message" data-error-cat="length">비밀번호는 6글자 이상 입력해주세요.</span>
                </span>
                </div>

                <div class="form-group">
                    <label for="confirmNewPassword">새 비밀번호 확인</label>
                    <input type="password" th:field="*{confirmNewPassword}" placeholder="새 비밀번호 확인">
                    <span class="message-container">
                    <span class="error-message" data-error-cat="empty">새 비밀번호 확인을 입력해주세요.</span>
                    <span class="error-message" data-error-cat="mismatch">새 비밀번호가 일치하지 않습니다.</span>
                </span>
                </div>

                <div class="password-modal-actions">
                    <button type="submit" class="change-password-btn">
                        <i class="bi bi-check-circle"></i>
                        비밀번호 변경
                    </button>
                    <button type="button" class="cancel-password-btn" onclick="closePasswordModal()">
                        <i class="bi bi-x-circle"></i>
                        취소
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>

<th:block layout:fragment="script">
    <script th:src="@{/js/edit-user.js}"></script>
</th:block>
</body>
</html>